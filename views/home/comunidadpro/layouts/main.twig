<!DOCTYPE html>
<html lang="en-US" class="no-js">



<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{{_company.meta_title}}</title>

    <link rel='shortcut icon' href='{{_company.favicon}}' />
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        body {
            {% for color_item in _company.colors %}
            --main-{{ color_item.alias }}: {{ color_item.color }};
            {% endfor %}
        }

        .swal2-confirm{
          background-color: var(--main-resaltar) !important};
        }
    </style>

    <link rel="stylesheet" href="/assets/template/comunidadpro/css/main.min.css">
    {% block css %} {% endblock %}
    {% set plataformas = [] %}
    {% set pro360 = [] %}
    {% set promotores = [] %}
    {% set aliados = [] %}
    {% set apis = [] %}
    
    
    {% for item in contents %}
        {% if item.alias == 'plataformas' %}
          {% for key in item.contents %}
            {% set plataformas = plataformas|merge([
              {
                'id': key.id,
                'alias': key.content_alias,
                'uniqid': key.uniqid,
                'title': key.content_name,
                'url': key.content_url,
                'description': key.content_description, 
                'image': key.files[0].url,
                'banners': key.imagens
              }]) %}
          {% endfor %}
        {% endif %}
        {% if item.alias == 'pro360' %}
          {% for key in item.contents %}
            {% set pro360 = pro360|merge([
              {
                'id': key.id,
                'alias': key.content_alias,
                'uniqid': key.uniqid,
                'title': key.content_name,
                'description': key.content_description,
                'banner': key.imagens[0]
              }]) %}
          {% endfor %}
        {% endif %}
        {% if item.alias == 'promotores' %}
          {% for key in item.contents %}
            {% set promotores = promotores|merge([
              {
                'id': key.id,
                'alias': key.content_alias,
                'uniqid': key.uniqid,
                'title': key.content_name,
                'banner': key.imagens[0]
              }]) %}
          {% endfor %}
        {% endif %}
        {% if item.alias == 'aliados' %}
          {% for key in item.contents %}
            {% set aliados = aliados|merge([
              {
                'id': key.id,
                'uniqid': key.uniqid,
                'title': key.content_name,
                'image': key.imagens[0].patch,
                'url': key.content_url
              }]) %}
          {% endfor %}
        {% endif %}
        {% if item.alias == 'apis' %}
          {% for key in item.contents %}
            {% set apis = apis|merge([
              {
                'id': key.id,
                'uniqid': key.uniqid,
                'title': key.content_name,
                'url_api': key.content_url
              }]) %}
          {% endfor %}
        {% endif %}
    {% endfor %}
    
    {% set sections = [
        {
          'alias': 'information',
          'contents': pro360
        },
        {
          'alias': 'accordion',
          'contents': plataformas
        },
        {
          'alias': 'products',
          'contents': apis
        }
      ]
    %}
</head>

<body translate="no">
    <header>
    {% include 'home/comunidadpro/layouts/partials/header.twig' with { active: 'home' } %}
    </header>
    <main role="main" class="pt-4">
        {% block content %} {% endblock %}
    </main>
    <footer class="py-5">
        {% include 'home/comunidadpro/layouts/partials/footer.twig'%}
    </footer>
    {% include "home/comunidadpro/partials/popup.twig" %}
    {% include "home/plugins.twig" with { whatsapp : true}  %}
    
    <script src="/assets/utilitarian/js/sweetalert2.js"></script>
    <script src="\assets\template\comunidadpro\js\bundle-main.min.js"></script>
    <script src="\assets\template\comunidadpro\js\library-main.min.js"></script>
    <script src="\assets\template\comunidadpro\js\main.min.js"></script>
    <script>document.addEventListener('DOMContentLoaded', () => {
      const formSignin = document.getElementById('formSignin');
      if (formSignin) {
        formSignin.addEventListener('submit', async (e) => {
          e.preventDefault();
          console.log(e);
          try {
            swal2.loading();
            const formdata = new FormData(e.target);
            const fetchResponse = await fetch('/{{_company.template_codigo}}/auth/signin',  {
                                    method: 'POST', // or 'PUT'
                                    body: formdata,
                                  });
            const result = await fetchResponse.json();
            if (result.success) {
              formSignin.reset();
              $('#modal-signin').modal('hide');
              swal2.show({
                icon: 'success',
                text: result.message,
                showCancelButton: false,
                onOk: () => {
                  swal2.loading();
                  window.location.href = window.location.protocol + '//' + window.location.host;
                }
              });
            } else {
              swal2.show({icon: 'error',text: result.message, showCancelButton: false});
            }
            console.log(result);
          } catch (e) {
            console.error(e);
            swal2.show({icon: 'error',text: 'error', showCancelButton: false});
          } 
        }, false);
      }
      const btnSignOut = document.getElementById('btnSignOut');
      if (btnSignOut) {
        btnSignOut.addEventListener('click', (e) => {
          console.log('click');
          e.preventDefault();
          swal2.show({
            icon: 'question',
            text: '¿Estás seguro de cerrar sesión?',
             showCancelButton: true,
            onOk: () => {
              swal2.loading();
              const formData = new FormData();
              fetch("/{{_company.template_codigo}}/auth/signout", {method: "POST", body: formData})
              .then(function(res){ return res.json(); })
              .then(function(rsp){
                if (rsp.success) {
                  swal2.show({
                    icon: 'success',
                    text: rsp.message,
                    showCancelButton: false,
                    onOk: () => {
                      swal2.loading();
                      window.location.href = window.location.protocol + '//' + window.location.host;
                    }
                  });
                } else {
                  swal2.show({icon: 'error',text: rsp.message, showCancelButton: false});
                }
              })
              .catch(function (err) {
                  console.error(err);
                  swal2.show({icon: 'error',text: 'Hubo un error en el sistema.', showCancelButton: false});
              });
            }
          });
        }, false);
      }
      const paneLogin = '{{ APP.GET.login }}';
      if (paneLogin == 'true' && $('#modal-signin')) {
        $('#modal-signin').modal('show');
      }
    });</script>
    {% block js %} {% endblock %}
    {% if _company.facebook_script %}
      {{ _company.facebook_script|raw }}
    {% endif %}
        {% if _company.tawkto_script %}
      {{ _company.tawkto_script|raw }}
    {% endif %}
</body>
</html>